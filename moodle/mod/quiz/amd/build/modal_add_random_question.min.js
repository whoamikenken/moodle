define("mod_quiz/modal_add_random_question",["exports","jquery","./add_question_modal","core/notification","core/fragment","core/templates","core_form/changechecker","core/ajax","core/pending"],(function(_exports,_jquery,_add_question_modal,Notification,Fragment,Templates,FormChangeChecker,_ajax,_pending){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_add_question_modal=_interopRequireDefault(_add_question_modal),Notification=_interopRequireWildcard(Notification),Fragment=_interopRequireWildcard(Fragment),Templates=_interopRequireWildcard(Templates),FormChangeChecker=_interopRequireWildcard(FormChangeChecker),_pending=_interopRequireDefault(_pending);const SELECTORS={ANCHOR:"a[href]",EXISTING_CATEGORY_CONTAINER:'[data-region="existing-category-container"]',EXISTING_CATEGORY_TAB:"#id_existingcategoryheader",NEW_CATEGORY_CONTAINER:'[data-region="new-category-container"]',NEW_CATEGORY_TAB:"#id_newcategoryheader",TAB_CONTENT:'[data-region="tab-content"]',ADD_ON_PAGE_FORM_ELEMENT:'[name="addonpage"]',ADD_RANDOM_BUTTON:'input[type="submit"][name="addrandom"]',ADD_NEW_CATEGORY_BUTTON:'input[type="submit"][name="newcategory"]',SUBMIT_BUTTON_ELEMENT:'input[type="submit"][name="addrandom"], input[type="submit"][name="newcategory"], input[type="submit"][name="update"]',FORM_HEADER:"legend",SELECT_NUMBER_TO_ADD:"#menurandomcount",NEW_CATEGORY_ELEMENT:"#categoryname",PARENT_CATEGORY_ELEMENT:"#parentcategory",FILTER_CONDITION_ELEMENT:"[data-filtercondition]",FORM_ELEMENT:"#add_random_question_form",MESSAGE_INPUT:'[name="message"]',SWITCH_TO_OTHER_BANK:'button[data-action="switch-question-bank"]',NEW_BANKMOD_ID:"data-newmodid",BANK_SEARCH:"#searchbanks",GO_BACK_BUTTON:'button[data-action="go-back"]',UPDATE_FILTER_BUTTON:'input[type="submit"][name="update"]'};class ModalAddRandomQuestion extends _add_question_modal.default{static init(contextId,bankCmId,category,returnUrl,quizCmId){let showNewCategory=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];document.addEventListener("click",(e=>{const trigger=e.target.closest('.menu [data-action="addarandomquestion"], [data-action="editrandomquestion"]');trigger&&(e.preventDefault(),trigger.dataset.slotid&&(showNewCategory=!1),ModalAddRandomQuestion.create({contextId:contextId,bankCmId:bankCmId,category:category,returnUrl:returnUrl,quizCmId:quizCmId,showNewCategory:showNewCategory,title:trigger.dataset.header,addOnPage:trigger.dataset.addonpage,slotId:trigger.dataset.slotid,templateContext:{hidden:showNewCategory}}))}))}constructor(root){super(root),this.category=null,this.returnUrl=null,this.quizCmId=null,this.loadedForm=!1,this.slotId=0,this.savedFilterCondition=null}configure(modalConfig){var _modalConfig$slotId,_modalConfig$savedFil;modalConfig.removeOnClose=!0,this.setCategory(modalConfig.category),this.setReturnUrl(modalConfig.returnUrl),this.showNewCategory=modalConfig.showNewCategory,this.setSlotId(null!==(_modalConfig$slotId=modalConfig.slotId)&&void 0!==_modalConfig$slotId?_modalConfig$slotId:0),this.setSavedFilterCondition(null!==(_modalConfig$savedFil=modalConfig.savedFilterCondition)&&void 0!==_modalConfig$savedFil?_modalConfig$savedFil:null),super.configure(modalConfig)}setAddOnPageId(id){super.setAddOnPageId(id),this.getBody().find(SELECTORS.ADD_ON_PAGE_FORM_ELEMENT).val(id)}setCategory(category){this.category=category}getCategory(){return this.category}setReturnUrl(url){this.returnUrl=url}getReturnUrl(){return this.returnUrl}setSlotId(slotId){this.slotId=slotId}getSlotId(){return this.slotId}setSavedFilterCondition(filterCondition){this.savedFilterCondition=filterCondition}getSavedFilterCondition(){return this.savedFilterCondition}moveContentIntoTab(tabContent,tabElement){tabContent.find(SELECTORS.FORM_HEADER).addClass("hidden"),tabContent.wrap(tabElement)}moveTabsIntoTabContent(form){const tabContent=this.getBody().find(SELECTORS.TAB_CONTENT).empty();form.find('[role="tabpanel"]').wrapAll(tabContent)}moveCancelButtonToTabs(form){const cancelButton=form.find(SELECTORS.CANCEL_BUTTON_ELEMENT).addClass("ms-1"),tabFooters=form.find('[data-region="footer"]');cancelButton.closest(SELECTORS.BUTTON_CONTAINER).remove(),cancelButton.clone().appendTo(tabFooters)}loadForm(){const addonpage=this.getAddOnPageId(),returnurl=this.getReturnUrl(),quizcmid=this.quizCmId,bankcmid=this.bankCmId,savedfiltercondition=this.getSavedFilterCondition();return this.setSavedFilterCondition(null),Fragment.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:null!=addonpage?addonpage:null,returnurl:returnurl,quizcmid:quizcmid,bankcmid:bankcmid,slotid:this.getSlotId(),savedfiltercondition:savedfiltercondition}).then(((html,js)=>{const form=(0,_jquery.default)(html);if(!this.getSlotId()){const existingCategoryTabContent=form.find(SELECTORS.EXISTING_CATEGORY_TAB),existingCategoryTab=this.getBody().find(SELECTORS.EXISTING_CATEGORY_CONTAINER),newCategoryTabContent=form.find(SELECTORS.NEW_CATEGORY_TAB),newCategoryTab=this.getBody().find(SELECTORS.NEW_CATEGORY_CONTAINER);this.moveContentIntoTab(existingCategoryTabContent,existingCategoryTab),this.moveContentIntoTab(newCategoryTabContent,newCategoryTab),this.moveTabsIntoTabContent(form)}Templates.replaceNode(this.getBody().find(SELECTORS.TAB_CONTENT),form,js)})).then((()=>{FormChangeChecker.disableAllChecks(),this.getBody()[0].addEventListener("click",(e=>{if(!e.target.closest(SELECTORS.SUBMIT_BUTTON_ELEMENT))return;e.preventDefault(),document.querySelector('#questionscontainer input[name="cmid"]').setAttribute("name",this.quizCmId);if(e.target.closest(SELECTORS.ADD_RANDOM_BUTTON)){var _document$querySelect;const randomcount=document.querySelector(SELECTORS.SELECT_NUMBER_TO_ADD).value,filtercondition=null===(_document$querySelect=document.querySelector(SELECTORS.FILTER_CONDITION_ELEMENT).dataset)||void 0===_document$querySelect?void 0:_document$querySelect.filtercondition;return void this.addQuestions(quizcmid,addonpage,randomcount,filtercondition,"","")}if(e.target.closest(SELECTORS.UPDATE_FILTER_BUTTON)){var _document$querySelect2;const filtercondition=null===(_document$querySelect2=document.querySelector(SELECTORS.FILTER_CONDITION_ELEMENT).dataset)||void 0===_document$querySelect2?void 0:_document$querySelect2.filtercondition;return void this.updateFilterCondition(quizcmid,this.getSlotId(),filtercondition)}e.target.closest(SELECTORS.ADD_NEW_CATEGORY_BUTTON)&&this.addQuestions(quizcmid,addonpage,1,"",document.querySelector(SELECTORS.NEW_CATEGORY_ELEMENT).value,document.querySelector(SELECTORS.PARENT_CATEGORY_ELEMENT).value)})),this.getModal().on("click",SELECTORS.SWITCH_TO_OTHER_BANK,(()=>{var _document$querySelect3;this.setSavedFilterCondition(null===(_document$querySelect3=document.querySelector(SELECTORS.FILTER_CONDITION_ELEMENT).dataset)||void 0===_document$querySelect3?void 0:_document$querySelect3.filtercondition),this.handleSwitchBankContentReload(SELECTORS.BANK_SEARCH).then((function(ModalQuizQuestionBank){var _$;return null===(_$=(0,_jquery.default)(SELECTORS.BANK_SEARCH))||void 0===_$||_$.on("change",(e=>{const bankCmId=(0,_jquery.default)(e.currentTarget).val();bankCmId>0&&ModalAddRandomQuestion.create({contextId:ModalQuizQuestionBank.getContextId(),bankCmId:bankCmId,category:ModalQuizQuestionBank.getCategory(),returnUrl:ModalQuizQuestionBank.getReturnUrl(),quizCmId:ModalQuizQuestionBank.quizCmId,title:ModalQuizQuestionBank.originalTitle,addOnPage:ModalQuizQuestionBank.getAddOnPageId(),templateContext:{hidden:ModalQuizQuestionBank.showNewCategory},showNewCategory:ModalQuizQuestionBank.showNewCategory,slotId:ModalQuizQuestionBank.getSlotId()}).then(ModalQuizQuestionBank.destroy()).catch(Notification.exception)})),ModalQuizQuestionBank}))})),this.getModal().on("click",SELECTORS.GO_BACK_BUTTON,(e=>{const anchorElement=(0,_jquery.default)(e.currentTarget);ModalAddRandomQuestion.create({contextId:this.getContextId(),bankCmId:anchorElement.attr("value"),category:this.getCategory(),returnUrl:this.getReturnUrl(),quizCmId:this.quizCmId,title:this.originalTitle,addOnPage:this.getAddOnPageId(),templateContext:{hidden:this.showNewCategory},showNewCategory:this.showNewCategory,savedFilterCondition:this.getSavedFilterCondition(),slotId:this.getSlotId()}).then(this.destroy()).catch(Notification.exception)})),this.getModal().on("click",SELECTORS.ANCHOR,(e=>{const anchorElement=(0,_jquery.default)(e.currentTarget);anchorElement.closest("a["+SELECTORS.NEW_BANKMOD_ID+"]").length&&ModalAddRandomQuestion.create({contextId:this.getContextId(),bankCmId:anchorElement.attr(SELECTORS.NEW_BANKMOD_ID),category:this.getCategory(),returnUrl:this.getReturnUrl(),quizCmId:this.quizCmId,title:this.originalTitle,addOnPage:this.getAddOnPageId(),templateContext:{hidden:this.showNewCategory},showNewCategory:this.showNewCategory,slotId:this.getSlotId()}).then(this.destroy()).catch(Notification.exception)}))})).catch(Notification.exception)}async addQuestions(quizcmid,addonpage,randomcount,filtercondition,newcategory,parentcategory){new _pending.default("mod-quiz/modal_add_random_questions");const call={methodname:"mod_quiz_add_random_questions",args:{cmid:quizcmid,addonpage:addonpage,randomcount:randomcount,filtercondition:filtercondition,newcategory:newcategory,parentcategory:parentcategory}};try{const response=await(0,_ajax.call)([call])[0],form=document.querySelector(SELECTORS.FORM_ELEMENT);form.querySelector(SELECTORS.MESSAGE_INPUT).value=response.message,form.submit()}catch(e){Notification.exception(e)}}async updateFilterCondition(quizcmid,slotid,filtercondition){new _pending.default("mod-quiz/modal_add_random_questions");const call={methodname:"mod_quiz_update_filter_condition",args:{cmid:quizcmid,slotid:slotid,filtercondition:filtercondition}};try{const response=await(0,_ajax.call)([call])[0],form=document.querySelector(SELECTORS.FORM_ELEMENT);form.querySelector(SELECTORS.MESSAGE_INPUT).value=response.message,form.submit()}catch(e){Notification.exception(e)}}show(){super.show(this),this.loadedForm||(this.tabHtml=this.getBody(),this.loadForm(window.location.search),this.loadedForm=!0)}}return _exports.default=ModalAddRandomQuestion,_defineProperty(ModalAddRandomQuestion,"TYPE","mod_quiz-quiz-add-random-question"),_defineProperty(ModalAddRandomQuestion,"TEMPLATE","mod_quiz/modal_add_random_question"),ModalAddRandomQuestion.registerModalType(),_exports.default}));

//# sourceMappingURL=modal_add_random_question.min.js.map